kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: nas-pvc
---
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: trainer-
spec:
  entrypoint: trainer-cpu
  volumes:
    - name: workdir
      persistentVolumeClaim:
        claimName: nas-pvc

  templates:
    - name: trainer-cpu
      container:
        image: registry.cn-hangzhou.aliyuncs.com/taylor/crf:cpu-py3
        imagePullPolicy: IfNotPresent
        command:
          - python
          - train.py
        volumeMounts:
          - name: workdir
            mountPath: /share/

    - name: trainer-gpu
      container:
        imagePullPolicy: IfNotPresent
        nodeSelector:
            aliyun.accelerator/nvidia_count: 4
        resources:
          limits:
            nvidia.com/gpu: 4                       
        image: registry.cn-hangzhou.aliyuncs.com/taylor/crf:gpu-py3
        command:
          - python
          - train.py
        volumeMounts:
          - name: workdir
            mountPath: /share/


    - name: trainer-gpu-multi-node
      container:
        imagePullPolicy: IfNotPresent
        nodeSelector:
            aliyun.accelerator/nvidia_count: 4
        resources:
          limits:
            nvidia.com/gpu: 4                       
        image: registry.cn-hangzhou.aliyuncs.com/taylor/crf:gpu-py3
        command:
          - python
          - train.py
        volumeMounts:
          - name: workdir
            mountPath: /share/

